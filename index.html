<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epsilon-4 Command Terminal</title>
    <style>
        /* --- THEME CONFIGURATION --- */
        :root {
            --bg-url: url('https://github.com/Bapoooossssaaaa/scpstuff/blob/main/Screenshot%202025-07-23%20063406.png?raw=true');
            /* Semi-transparent Glass (65% opacity) */
            --glass-bg: rgba(15, 25, 35, 0.65);
            --glass-border: rgba(255, 255, 255, 0.15);
            --text-color: #e0e6ed;
            --accent-blue: #5c9eff;
            --accent-hover: #82baff;
            --error-red: #ff6b6b;
            --input-bg: rgba(0, 0, 0, 0.5);
            --font-main: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            --font-tech: "Courier New", Courier, monospace;
        }

        /* --- GLOBAL STYLES --- */
        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            color: var(--text-color);
            background-image: var(--bg-url);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #1a202c;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: -1;
        }

        /* --- MAIN CONTAINER --- */
        .terminal-window {
            width: 90%;
            max-width: 800px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 2rem;
            animation: fadeIn 0.4s ease-out;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- HEADER --- */
        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 1rem;
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-blue);
            text-shadow: 0 0 10px rgba(92, 158, 255, 0.5);
        }

        p.subtitle {
            margin: 0.5rem 0 0;
            font-size: 0.9rem;
            color: #b0c4de;
        }

        /* --- HANDBOOK BUTTON --- */
        .handbook-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 30px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .handbook-btn:hover {
            background: var(--accent-blue);
            color: white;
            box-shadow: 0 0 10px var(--accent-blue);
        }

        /* --- HANDBOOK MODAL --- */
        .handbook-modal {
            display: none; /* Hidden by default */
            position: absolute;
            top: 60px;
            right: 20px;
            width: 300px;
            background: rgba(10, 15, 25, 0.95);
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 15px;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            font-size: 0.85rem;
            line-height: 1.4;
        }
        .handbook-modal h3 {
            margin-top: 0;
            color: var(--accent-blue);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 5px;
        }
        .handbook-modal ul {
            padding-left: 20px;
            margin-bottom: 0;
        }
        .handbook-modal li {
            margin-bottom: 5px;
        }

        /* --- FORM GRID --- */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .full-width {
            grid-column: span 2;
        }

        @media (max-width: 600px) {
            .controls-grid { grid-template-columns: 1fr; }
            .full-width { grid-column: span 1; }
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: #dbeafe;
            text-transform: uppercase;
            text-shadow: 0 0 2px rgba(0,0,0,0.8);
        }

        input, select {
            padding: 12px;
            border-radius: 6px;
            border: 1px solid var(--glass-border);
            background: var(--input-bg);
            color: #fff;
            font-family: var(--font-tech);
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 8px rgba(92, 158, 255, 0.3);
        }

        /* Custom Hat Input Area */
        .hat-adder {
            display: flex;
            gap: 10px;
        }
        .hat-adder input {
            flex-grow: 1;
        }
        .add-btn {
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 6px;
            width: 45px;
            font-size: 1.2rem;
            cursor: pointer;
        }
        .add-btn:hover {
            background: var(--accent-hover);
        }

        /* Custom Hat List */
        .hat-list {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .hat-item {
            background: rgba(255,255,255,0.1);
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: var(--font-tech);
        }
        .hat-remove {
            color: #ff6b6b;
            cursor: pointer;
            font-weight: bold;
        }
        .hat-remove:hover {
            text-decoration: underline;
        }

        /* Error Box */
        .error-message {
            grid-column: span 2;
            color: var(--error-red);
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid var(--error-red);
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9rem;
            text-align: center;
            display: none;
        }

        /* --- BUTTONS --- */
        .btn-primary {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8) 0%, rgba(29, 78, 216, 0.9) 100%);
            color: white;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 14px;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: transform 0.1s, box-shadow 0.2s;
            backdrop-filter: blur(4px);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-copy {
            background: rgba(39, 47, 61, 0.8);
            border: 1px solid var(--glass-border);
            color: #a0aec0;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            transition: all 0.2s;
        }

        .btn-copy:hover {
            background: rgba(45, 55, 72, 0.9);
            color: white;
            border-color: var(--accent-blue);
        }

        /* --- OUTPUT AREA --- */
        .output-section {
            margin-top: 2rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid var(--glass-border);
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        textarea {
            width: 100%;
            height: 250px;
            background: transparent;
            border: none;
            color: var(--accent-blue);
            font-family: var(--font-tech);
            font-size: 0.85rem;
            resize: vertical;
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
        }

        textarea:focus {
            outline: none;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="terminal-window">
        <!-- Handbook Button -->
        <div class="handbook-btn" onclick="toggleHandbook()">?</div>
        <!-- Handbook Modal -->
        <div id="handbook-modal" class="handbook-modal">
            <h3>Terminal Handbook</h3>
            <p><strong>System Usage:</strong></p>
            <ul>
                <li><strong>Rank:</strong> Automatically sets uniform.</li>
                <li><strong>Division:</strong> Currently MAIN FORCE only.</li>
                <li><strong>Loadouts:</strong> Restricted by Rank Level.</li>
                <li><strong>Custom Morph:</strong> Use the "Custom Hat IDs" box to add extra IDs. Type one ID, click (+), repeat.</li>
                <li><strong>HC Health:</strong> High Command must manually input health (180-200).</li>
            </ul>
        </div>

        <header>
            <h1>Epsilon-4 Logistics</h1>
            <p class="subtitle">Morph & Loadout Command Generator</p>
        </header>

        <div class="controls-grid">
            <!-- Username -->
            <div class="input-group">
                <label for="username">Target User *</label>
                <input type="text" id="username" placeholder="RobloxUsername (Required)">
            </div>

            <!-- Codename -->
            <div class="input-group">
                <label for="codename">Codename *</label>
                <input type="text" id="codename" placeholder="e.g. Viper (Required)">
            </div>

            <!-- Division -->
            <div class="input-group full-width">
                <label for="division">Division</label>
                <select id="division">
                    <option value="MAIN">Main Force</option>
                    <option value="disabled" disabled>Engineering (Coming Soon)</option>
                    <option value="disabled" disabled>Medical (Coming Soon)</option>
                    <option value="disabled" disabled>Intelligence (Coming Soon)</option>
                </select>
            </div>

            <!-- Rank Selection -->
            <div class="input-group full-width">
                <label for="rank">Rank</label>
                <select id="rank" onchange="updateUI()">
                    <optgroup label="Low Ranks (LR)">
                        <option value="JO">Junior Operative (E4-JO)</option>
                        <option value="O">Operative (E4-O)</option>
                        <option value="SO">Senior Operative (E4-SO)</option>
                        <option value="LO">Lead Operative (E4-LO)</option>
                    </optgroup>
                    <optgroup label="Middle Ranks (MR)">
                        <option value="CPL">Corporal (E4-CPL)</option>
                        <option value="SGT">Sergeant (E4-SGT)</option>
                        <option value="MSGT">Master Sergeant (E4-MSGT)</option>
                        <option value="SPC">Specialist (E4-SPC)</option>
                    </optgroup>
                    <optgroup label="High Ranks (HR)">
                        <option value="EO">Entry Officer</option>
                        <option value="LT">Lieutenant</option>
                        <option value="CPT">Captain</option>
                        <option value="MAJ">Major</option>
                        <option value="COL">Colonel</option>
                    </optgroup>
                    <optgroup label="High Command (HC)">
                        <option value="TFD">Task Force Director</option>
                        <option value="TFDD">Task Force Deputy Director</option>
                        <option value="TFC">Task Force Commander</option>
                        <option value="TFE">Task Force Executive</option>
                        <option value="TFA">Task Force Advisor</option>
                    </optgroup>
                </select>
            </div>

            <!-- Morph Selection -->
            <div class="input-group full-width">
                <label for="morph">Loadout</label>
                <select id="morph" onchange="updateUI()">
                    <option value="LR_STD">LR Standard (Hats + Stats)</option>
                    <option value="MR_STD">MR Standard (Hats + NVG + Stats)</option>
                    <option value="HR_STD">HR Standard (Hats + NVG + Stats)</option>
                    <option value="HR_CMD">HR/HC Command Focused</option>
                    <option value="HC_STD">HC Standard (Full Kit)</option>
                    <option value="GAS">Gasmask Version (HC Only)</option>
                    <option value="INSTR_GEAR">Instructor Gear (HR+ Only)</option>
                    <option value="CUSTOM">Custom (No Hats - MR+)</option>
                </select>
            </div>

            <!-- Custom Hat Input (Hidden by default) -->
            <div id="custom-hats-container" class="input-group full-width" style="display: none;">
                <label>Custom Hat IDs (Add one by one)</label>
                <div class="hat-adder">
                    <input type="text" id="customHatId" placeholder="Enter ID string or 'Kneepads'">
                    <button class="add-btn" onclick="addCustomHat()">+</button>
                </div>
                <div id="hats-list" class="hat-list">
                    <!-- Added hats go here -->
                </div>
            </div>

            <!-- HC Custom Health (Hidden by default) -->
            <div id="hc-health-container" class="input-group full-width" style="display: none;">
                <label for="hcHealth">HC Health Amount (180 - 200) *</label>
                <input type="number" id="hcHealth" min="180" max="200" value="200" placeholder="Enter Amount">
            </div>
            
            <!-- Error Message Box -->
            <div id="error-box" class="error-message"></div>

            <button class="btn-primary full-width" onclick="generateCommand()">Generate Command</button>
        </div>

        <div class="output-section">
            <div class="output-header">
                <label>Command Output</label>
                <button class="btn-copy" onclick="copyToClipboard()">Copy to Clipboard</button>
            </div>
            <textarea id="output" readonly>Waiting for input...</textarea>
        </div>
    </div>

    <script>
        // --- DATA CONFIGURATION ---
        
        // 1. Uniforms & Rank Types
        const ranks = {
            "JO":   { shirt: "104705880084468", pants: "11396300033", title: "Junior Operative", abbr: "TFJO", type: "LR" },
            "O":    { shirt: "92840459882561",  pants: "11396300033", title: "Operative", abbr: "TFO", type: "LR" },
            "SO":   { shirt: "108433158024625", pants: "11396300033", title: "Senior Operative", abbr: "TFSO", type: "LR" },
            "LO":   { shirt: "81993824138263",  pants: "11396300033", title: "Lead Operative", abbr: "TFLO", type: "LR" },
            
            "CPL":  { shirt: "97706194316330",  pants: "11396300033", title: "Corporal", abbr: "TFCPL", type: "MR" },
            "SGT":  { shirt: "75336808265246",  pants: "11396300033", title: "Sergeant", abbr: "TFSGT", type: "MR" },
            "MSGT": { shirt: "82949421071097",  pants: "11396300033", title: "Master Sergeant", abbr: "TFMSGT", type: "MR" },
            "SPC":  { shirt: "101027756318824", pants: "11396300033", title: "Specialist", abbr: "TFSPC", type: "MR" },
            
            "EO":   { shirt: "75195745762310",  pants: "11396300033", title: "Entry Officer", abbr: "TFEO", type: "HR" },
            "LT":   { shirt: "75195745762310",  pants: "11396300033", title: "Lieutenant", abbr: "TFLT", type: "HR" },
            "CPT":  { shirt: "75195745762310",  pants: "11396300033", title: "Captain", abbr: "TFCPT", type: "HR" },
            "MAJ":  { shirt: "75195745762310",  pants: "11396300033", title: "Major", abbr: "TFMAJ", type: "HR" },
            "COL":  { shirt: "75195745762310",  pants: "11396300033", title: "Colonel", abbr: "TFCOL", type: "HR" },
            
            "TFD":  { shirt: "96024883099372",  pants: "11396300033", title: "Director", abbr: "TFD", type: "HC" },
            "TFDD": { shirt: "96024883099372",  pants: "11396300033", title: "Deputy Director", abbr: "TFDD", type: "HC" },
            "TFC":  { shirt: "96024883099372",  pants: "11396300033", title: "Commander", abbr: "TFC", type: "HC" },
            "TFE":  { shirt: "96024883099372",  pants: "11396300033", title: "Executive", abbr: "TFE", type: "HC" },
            "TFA":  { shirt: "96024883099372",  pants: "11396300033", title: "Advisor", abbr: "TFA", type: "HC" }
        };

        // 2. Loadout Definitions (Added ivest to all EXCEPT INSTR_GEAR)
        const loadouts = {
            "LR_STD": {
                hats: "117694264830848 87997515473963 Kneepads 138865739156425 118419000573594 Holster 15502514305 129351084728323 18803205025 17266468821 13770147630 137724639107553 ivest",
                health: 120,
                tagType: "LR"
            },
            "MR_STD": {
                hats: "76366177662456 jnvg 255 255 255 87997515473963 Kneepads 138865739156425 118419000573594 Holster 15502514305 129351084728323 18803205025 13834560407 17266468821 13770147630 137724639107553 ivest",
                health: 150,
                tagType: "MR"
            },
            "HR_STD": {
                hats: "jqnvg 255 255 255 87997515473963 Kneepads 138865739156425 118419000573594 Holster 15502514305 85455607289541 129351084728323 18803205025 13834560407 17266468821 13770147630 137724639107553 ivest",
                health: 170,
                tagType: "HR"
            },
            "HR_CMD": {
                hats: "13894334548 10788217931 87997515473963 Kneepads 139486942466667 138865739156425 Holster 85455607289541 18803205025 13770147630 ivest",
                health: 170,
                tagType: "HR"
            },
            "HC_STD": {
                hats: "jqnvg 255 255 255 87997515473963 Kneepads 138865739156425 118419000573594 Holster 15502514305 85455607289541 129351084728323 18803205025 13834560407 17266468821 13770147630 137724639107553 ivest",
                health: "CUSTOM_HC",
                tagType: "HC"
            },
            "GAS": {
                hats: "Gasmask2 13770147630 18803205025 14807864072 87997515473963 10788217931 Kneepads 138865739156425 85455607289541 Holster ivest",
                health: "CUSTOM_HC", 
                tagType: "HC"
            },
            "INSTR_GEAR": {
                hats: "15511696894 18803205025 holster",
                health: "SMART", 
                tagType: "SMART"
            },
            "CUSTOM": {
                hats: "87997515473963 Kneepads 138865739156425 Holster 85455607289541 18803205025 ivest",
                health: "SMART", 
                tagType: "SMART"
            }
        };

        const allowedMorphs = {
            "LR": ["LR_STD"],
            "MR": ["MR_STD", "CUSTOM"], 
            "HR": ["HR_STD", "HR_CMD", "CUSTOM", "INSTR_GEAR"], 
            "HC": ["HC_STD", "HR_CMD", "GAS", "CUSTOM", "INSTR_GEAR"] 
        };

        const rankStats = {
            "LR": { health: 120, tag: "LR", card: "l2" },
            "MR": { health: 150, tag: "MR", card: "l2" },
            "HR": { health: 170, tag: "HR", card: "l3" },
            "HC": { health: 200, tag: "HC", card: "l3" } 
        };

        const tagTemplates = {
            "LR": "﹝ Epsilon - 4 ﹞ <br/> 〔 MAINFORCE | LR | CL-II 〕",
            "MR": "﹝ Epsilon - 4 ﹞ <br/> 〔 MAIN FORCE | MR | CL-II 〕",
            "HR": "﹝ Epsilon - 4 ﹞ <br/> 〔 MAINFORCE | HR | CL-III 〕"
        };

        // --- GLOBAL VARIABLES ---
        let customHats = [];

        // --- FUNCTIONS ---

        function toggleHandbook() {
            const modal = document.getElementById('handbook-modal');
            modal.style.display = (modal.style.display === 'block') ? 'none' : 'block';
        }

        function updateUI() {
            const rankSelect = document.getElementById('rank');
            const morphSelect = document.getElementById('morph');
            const hcHealthBox = document.getElementById('hc-health-container');
            const customHatBox = document.getElementById('custom-hats-container');
            
            const rankKey = rankSelect.value;
            const rankType = ranks[rankKey].type;
            const allowed = allowedMorphs[rankType];
            const currentMorph = morphSelect.value;

            // 1. Update Allowed Morphs
            let firstValid = null;
            for (let i = 0; i < morphSelect.options.length; i++) {
                const opt = morphSelect.options[i];
                if (allowed.includes(opt.value)) {
                    opt.hidden = false;
                    opt.disabled = false;
                    if (!firstValid) firstValid = opt.value;
                } else {
                    opt.hidden = true;
                    opt.disabled = true;
                }
            }
            if (!allowed.includes(currentMorph)) {
                morphSelect.value = firstValid;
            }

            // 2. Show/Hide HC Health Box
            if (rankType === 'HC') {
                hcHealthBox.style.display = 'flex';
            } else {
                hcHealthBox.style.display = 'none';
            }

            // 3. Show/Hide Custom Hat Input
            // Check newly selected morph value
            if (morphSelect.value === 'CUSTOM') {
                customHatBox.style.display = 'block';
            } else {
                customHatBox.style.display = 'none';
                customHats = []; // Clear array
                renderCustomHats(); // Clear UI
            }
        }

        // --- Custom Hat Logic ---
        function addCustomHat() {
            const input = document.getElementById('customHatId');
            const val = input.value.trim();
            if (val) {
                customHats.push(val);
                input.value = '';
                renderCustomHats();
            }
        }

        function removeCustomHat(index) {
            customHats.splice(index, 1);
            renderCustomHats();
        }

        function renderCustomHats() {
            const list = document.getElementById('hats-list');
            list.innerHTML = '';
            customHats.forEach((hat, index) => {
                const item = document.createElement('div');
                item.className = 'hat-item';
                item.innerHTML = `${hat} <span class="hat-remove" onclick="removeCustomHat(${index})">x</span>`;
                list.appendChild(item);
            });
        }

        window.onload = function() {
            updateUI();
        };

        function showError(msg) {
            const errBox = document.getElementById('error-box');
            errBox.innerText = msg;
            errBox.style.display = 'block';
        }

        function clearError() {
            const errBox = document.getElementById('error-box');
            errBox.style.display = 'none';
            errBox.innerText = '';
        }

        function generateCommand() {
            clearError();

            // 1. Validation
            let user = document.getElementById('username').value.trim();
            const codename = document.getElementById('codename').value.trim();
            
            if (!user || !codename) {
                showError("ERROR: Username and Codename are REQUIRED.");
                return;
            }

            const rankKey = document.getElementById('rank').value;
            const morphKey = document.getElementById('morph').value;

            // 2. Data Retrieval
            const rData = ranks[rankKey];
            const lData = loadouts[morphKey];

            // 3. Stats Logic
            let finalHealth = lData.health;
            let finalTagType = lData.tagType;
            let cardLevel = rankStats[rData.type].card;

            // Health Logic
            if (rData.type === 'HC') {
                const hcVal = parseInt(document.getElementById('hcHealth').value);
                if (!hcVal || hcVal < 180 || hcVal > 200) {
                    showError("ERROR: HC Health must be between 180 and 200.");
                    return;
                }
                finalHealth = hcVal;
                finalTagType = "HC"; 
            }
            else if (finalHealth === "CUSTOM_HC") {
                finalHealth = 200; 
            }
            else if (finalHealth === "SMART") {
                const stats = rankStats[rData.type];
                finalHealth = stats.health;
                finalTagType = stats.tag;
            }

            // 4. Strings Construction
            const nameTagHTML = `<stroke color="#000000" thickness="1"><font face="Michroma"> ${rData.abbr}⎰" ${codename} ” </font></stroke>`;
            
            let roleTagString = "";
            const blueRGB = "50 100 200";

            if (rData.type === 'HC') {
                let roleText = "HC"; 
                if (rankKey === "TFD") roleText = "FL";
                if (rankKey === "TFDD") roleText = "COFL";
                roleTagString = `﹝ Epsilon - 4 ﹞ <br/> 〔 COMMAND | ${roleText} | CL-III 〕`;
            } else {
                roleTagString = tagTemplates[finalTagType];
            }

            const roleTagHTML = `<font face="Michroma"> ${roleTagString} </font>`;

            let cmds = [];

            // Reset
            cmds.push(`Permmorph ${user} remove`);

            // Uniform
            cmds.push(`Permshirt ${user} ${rData.shirt} ${rData.pants}`);

            // Hats Logic
            let combinedHats = lData.hats;
            // Append custom hats if any
            if (morphKey === 'CUSTOM' && customHats.length > 0) {
                combinedHats += " " + customHats.join(" ");
            }
            cmds.push(`Permhat ${user} ${combinedHats}`);

            // Re-added Permcolornvg if NVG is present in the hats string
            if (combinedHats.includes('jnvg') || combinedHats.includes('jqnvg')) {
                cmds.push(`Permcolornvg ${user} 255,255,255`);
            }

            // Tags
            cmds.push(`Permntag ${user} ${nameTagHTML}`);
            cmds.push(`Permrtag ${user} ${roleTagHTML}`);
            cmds.push(`Permcntag ${user} ${blueRGB}`);
            cmds.push(`Permcrtag ${user} ${blueRGB}`);

            // Gear
            cmds.push(`Startergear ${user} Honey,sgm9,m9,${cardLevel}`);
            cmds.push(`Permmxhealth ${user} ${finalHealth}`);

            // Output
            const finalCommand = "Run " + cmds.join(" &\n");
            document.getElementById('output').value = finalCommand;
        }

        function copyToClipboard() {
            const outputEl = document.getElementById("output");
            outputEl.select();
            outputEl.setSelectionRange(0, 99999);

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(outputEl.value)
                    .then(() => alert("Command copied!"))
                    .catch(() => fallbackCopy());
            } else {
                fallbackCopy();
            }
        }

        function fallbackCopy() {
            try {
                document.execCommand('copy');
                alert("Command copied!");
            } catch (err) {
                alert("Failed to copy automatically.");
            }
        }
    </script>
</body>
</html>
